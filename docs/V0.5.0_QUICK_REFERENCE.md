# v0.5.0 "Sovereign Signal" - Quick Reference

## ğŸ¯ What Changed?

OurBlock now supports **domain-less** P2P connectivity! No more static IPs, domain names, or port forwarding needed.

## ğŸ“‹ Quick Comparison

| Feature | V1 (Old) | V2 (New) |
|---------|----------|----------|
| **Format** | Colon-separated | JSON (base64) |
| **Hub ID** | IP/Domain | Agent Public Key |
| **Connection** | HTTP Direct | P2P via Signal Server |
| **NAT Required** | Port forwarding | Auto NAT traversal |
| **Static IP** | Yes | No |
| **Domain Name** | Optional | Not used |

## ğŸ”‘ Invite Code Formats

### V1 (Legacy)
```
OURBLOCK_V1:192.168.1.100:5000:abc123:1234567890:sig==
             â””â”€hub addressâ”€â”€â”˜ â””seedâ”˜ â””timestampâ”€â”˜ â””sigâ”€â”˜
```

### V2 (New - P2P)
```
OURBLOCK_V2:eyJuZXR3b3JrX3NlZWQiOi...
             â””â”€ Base64-encoded JSON â”€â”€â”˜
```

**V2 JSON contains:**
- `network_seed` - Shared network identifier
- `hub_agent_pub_key` - Hub's P2P identity
- `signal_url` - Signal server for P2P relay
- `bootstrap_url` - Network bootstrap server
- `timestamp` - Creation time
- `signature` - Cryptographic proof

## ğŸš€ Quick Start

### For Hub Admins

**1. Update Environment (if using custom servers):**
```bash
# Use Holochain's public infrastructure (default)
SIGNAL_URL="wss://signal.holochain.org"
BOOTSTRAP_URL="https://bootstrap.holochain.org"
```

**2. Restart Conductor:**
```bash
docker compose restart conductor
```

**3. Generate Invite:**
- Navigate to Admin page
- Click "Create Invite Code"
- Code will automatically be V2 format
- Share with neighbors!

### For Neighbors

**1. Get Invite Code:**
- Ask your neighborhood admin for invite

**2. Join:**
- Open OurBlock
- Click "Join Neighborhood"
- Paste invite code
- If code starts with `OURBLOCK_V2:`, you'll see "Domain-less P2P Discovery"
- Click Join!

**3. Verify:**
- Check for "Connected" status
- View neighborhood posts/events
- No HTTP errors = success!

## ğŸ” How to Tell What Version You Have

### In the UI

**When joining:**
- V1 shows: `Hub: 192.168.1.100:5000`
- V2 shows: `Mode: Domain-less P2P Discovery`

**In logs:**
```
V1: "Using V1 invite with traditional discovery"
V2: "Using V2 invite with P2P discovery"
```

### Code Inspection

```typescript
const parsed = parseInviteCode(code);
if (parsed.version === 'V2') {
  // P2P discovery enabled
  console.log('Signal:', parsed.signalUrl);
} else {
  // Legacy HTTP connection
  console.log('Hub:', parsed.hubAddress);
}
```

## âœ… Benefits Summary

### V2 Advantages
- âœ… Works behind NAT/firewall
- âœ… No static IP needed
- âœ… No domain required
- âœ… No port forwarding
- âœ… Faster connections (WebRTC)
- âœ… More reliable (Holochain infrastructure)
- âœ… Better privacy (no centralized server)
- âœ… Mobile-friendly (works on 4G/5G)

### V1 Still Works!
- âœ… Backwards compatible
- âœ… Existing codes valid
- âœ… No migration required
- âœ… Choose based on your needs

## ğŸ› ï¸ Troubleshooting

### "Could not connect to signal server"

**Check signal server:**
```bash
# Test public signal server
curl -v wss://signal.holochain.org
```

**Fix:**
- Verify internet connection
- Check firewall allows WSS (port 443)
- Verify `SIGNAL_URL` environment variable

### "P2P discovery failed"

**Check conductor:**
```bash
# View conductor logs
docker compose logs conductor | grep -i webrtc
```

**Fix:**
- Restart conductor
- Verify network config in `conductor-config.yaml`
- Check firewall allows UDP (WebRTC)

### "Invite code rejected"

**Verify format:**
```bash
# V2 code should decode to JSON
echo "OURBLOCK_V2:..." | cut -d: -f2 | base64 -d
```

**Fix:**
- Check code not expired (default 7 days)
- Verify no copy/paste errors
- Ensure network_seed matches
- Request new code from admin

## ğŸ“Š Performance Expectations

### V2 Connection Times

| Step | Time | Notes |
|------|------|-------|
| Parse invite | <10ms | JSON decode |
| Install app | 1-3s | Holochain setup |
| P2P discovery | 2-5s | Via signal server |
| First sync | 5-10s | Initial data |
| **Total** | **8-18s** | First join |

### Comparison to V1

| Metric | V1 (HTTP) | V2 (P2P) |
|--------|-----------|----------|
| Join time | 10-15s | 8-18s |
| NAT support | Manual | Automatic |
| Reliability | Hub uptime | Signal + P2P |
| Privacy | HTTP visible | Encrypted P2P |

## ğŸ” Security Notes

### What's Signed

**V1:**
```
hub_address + network_seed + timestamp
```

**V2:**
```
network_seed + timestamp + signal_url
```

### Verification

Both formats verify:
- âœ… Signature matches hub's key
- âœ… Timestamp not expired
- âœ… Network seed matches
- âœ… No tampering detected

### Trust Model

**V1:**
- Trust hub's IP address
- Trust HTTP connection
- Manual verification of hub identity

**V2:**
- Trust hub's agent public key
- Trust signal server for relay (not data)
- Cryptographic verification of hub identity

## ğŸ“š Additional Resources

- [Full Documentation](./V2_INVITE_CODES.md)
- [Implementation Details](./V0.5.0_IMPLEMENTATION.md)
- [Architecture Overview](../ARCHITECTURE.md)
- [Security Audit](../PRODUCTION_READINESS.md)

## ğŸ†˜ Getting Help

**Issue:** Connection problems  
**Check:** Conductor logs, network config, firewall

**Issue:** Code validation fails  
**Check:** Format, expiration, signature

**Issue:** V1 codes not working  
**Status:** Backwards compatibility maintained

**Need Help?**
1. Check [V2_INVITE_CODES.md](./V2_INVITE_CODES.md) troubleshooting section
2. Review conductor logs
3. Open GitHub issue with logs

## ğŸ“ Developer Notes

### Type Discrimination

```typescript
function handleInvite(parsed: ParsedInviteCode) {
  if (parsed.version === 'V2') {
    // TypeScript knows this is ParsedInviteCodeV2
    connectViaP2P(parsed.hubAgentPubKey, parsed.signalUrl);
  } else {
    // TypeScript knows this is ParsedInviteCodeV1
    connectViaHTTP(parsed.hubAddress);
  }
}
```

### Testing Both Formats

```typescript
describe('Invite Codes', () => {
  it('parses V1', () => {
    const v1 = 'OURBLOCK_V1:host:seed:ts:sig';
    expect(parseInviteCode(v1)?.version).toBe('V1');
  });
  
  it('parses V2', () => {
    const v2 = 'OURBLOCK_V2:' + btoa(JSON.stringify({...}));
    expect(parseInviteCode(v2)?.version).toBe('V2');
  });
});
```

## ğŸ”„ Migration Path

### Existing Hubs

1. âœ… Update OurBlock to v0.5.0
2. âœ… Restart conductor (auto-detects V2)
3. âœ… New invites use V2 format
4. âœ… Old V1 codes still work
5. âœ… No user action required

### For Developers

```typescript
// OLD (V1 only):
const hubUrl = `http://${parsed.hubAddress}/api`;

// NEW (V1/V2 compatible):
if (parsed.version === 'V2') {
  // P2P - no HTTP needed
  // Conductor handles everything
} else {
  const hubUrl = `http://${parsed.hubAddress}/api`;
}
```

## â­ï¸ What's Next?

**v0.5.1 - Battery Optimization:**
- Gossip interval tuning
- Power-aware sync
- Edge device optimization

**v0.6.0 - Production Hardening:**
- Automated TLS (Let's Encrypt)
- Monitoring (Sentry)
- Performance profiling

**v0.7.0 - Advanced P2P:**
- Custom signal servers
- Multi-hub federation
- Hybrid V1/V2 mode

---

**Version:** v0.5.0 "Sovereign Signal"  
**Status:** Production Candidate (88/100)  
**Released:** [Date]  
**License:** MIT
